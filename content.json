{"meta":{"title":"WinNote","subtitle":"","description":"","author":"winotmk","url":"http://example.com","root":"/"},"pages":[],"posts":[{"title":"","slug":"nas内网穿透","date":"2021-09-29T05:22:12.349Z","updated":"2020-02-06T14:02:48.000Z","comments":true,"path":"2021/09/29/nas内网穿透/","link":"","permalink":"http://example.com/2021/09/29/nas%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/","excerpt":"","text":"##起因因为疫情严重不得不在家办公，无奈TeamViewer很多软件打开都是白屏，稳定性也很是不爽，所以结合现有资源做了个内网穿透，将公司的电脑远程登陆地址映射到公网上，在家用windows自带的远程桌面连接，实测效果比TeamViewer好得多。 之前配NAS的时候，家里整过光猫，改成路由拨号所以有公网ip，也在nas上运行了ddns程序，另外这台群晖nas不出意外会一直开机（因为跑了文件存储和日记服务），这样一来就有现成的条件做内网穿透服务器了，搞起来~ ##前期准备 公司电脑开机,且打开TeamViewer，配好之前还得使它 家里路由配好端口转发和ddns 住处有电脑 ###NAS上的配置 登录DSM（群晖的网页系统，很nb），开启SSH 默认是22端口 在路由上设置转发 win+R输入cmd打开终端 1ssh 群晖登录账号@winotmk.***.net 输入密码回车登录。因为配了ddns直接输域名就好 1sudo -i //root权限，注意是由$变为# 用root登录 12cd /etc/sshchmod 755 sshd_config //赋权 1vim /etc/ssh/sshd_config 修改config文件，输入 i 编辑 将#PermitRootLogin prohibit password 修改为：PermitRootLogin yes 去掉#号 之后多按几下ESC 退出编辑模式，再输入 :wq 回车保存 1synouser --setpw root xxxxxxx 修改root密码，xxxx换成自己的 1reboot //重启群晖 现在可以直接用root登录ssh了 ###winscp登录用这个是因为我对linux指令不熟，图形界面很友好，可以本地制作好文件以后再上传运行，非常简单和ssh一样输入好地址就能连接用了，注意协议选SCP，第一次选的是SFTP，神奇的是也连上了，但是出现的是NAS的硬盘盘符而不是linux内部的路径，在这里懵了很久 ##服务端配置 ###配置frps github地址： https://github.com/fatedier/frp/releases 家里的双盘位群晖是arm的cpu所以选了frp_0.31.2_linux_arm.tar.gz 直接下载下来，解压，编辑frps.ini 12345[common]bind_port = 7000dashboard_port = 7500dashboard_user = admindashboard_pwd = admin 加了三行是打开了网页后台界面，可以康康frp的运行情况 当然，路由上也要给7000和7500添加端口转发 登录winscp 根目录下创建frp文件夹 （其实只用把frps相关的复制过去就好） 右键属性，给0755权限 ###启动frps打开终端，cd到/frp目录下 然后执行 1./frps -c ./frps.ini 出现巴拉巴拉success就是成功了 但是不能关闭终端，否则程序会关闭。一般来说我们是需要后台一直运行着的，所以我们使用nohup命令让其后台执行。 1nohup ./frps -c frps.ini ps:linux退出当前程序是ctrl+c或者q ###设置群晖nas开机自动运行frps新增用户自定义脚本 如下图设置 设置脚本 1/frp/frps -c /frp/frps.ini 勾选保存 至此服务端的部分设置完成，可以通过http://****.net:7500/访问看见界面 ##客户端配置 下载frp_0.31.2_windows_386.zipwindows版本 解压修改frpc.ini 123456789[common]server_addr = winotmk.imwork.net //服务器地址server_port = 7000[yuanchengzhuomian] //名字自己起，根据需要可以多写type = tcp //远程桌面走的是tcplocal_ip = 127.0.0.1 //当然是本地ip，别写成服务器的了别问我为啥local_port = 3389 //本地端口，远程桌面默认是3389，想改去改注册表remote_port = 3389 //给外面访问的端口，需要在路由上配端口转发，不一定和上面本地端口一样 保存关闭，新建一个start.bat批处理，写上 1frpc.exe -c frpc.ini 保存运行就能启动客户端了 当然还有一个问题，那就是我们同样无法关闭dos命令框，如果关闭frp也同时被关闭了，所以我们需要同样需要后台执行，所以我找到了一种办法，可以使其后台运行。编写一个vbs脚本（这个方法我没试，出处 ##远程桌面 ok折腾完了，现在直接点开公司电脑的此电脑右键属性，按下图设置，添加可以访问的用户 在自己电脑打开远程桌面，就可以连接了 做完了以后忽然想起来，我为什么不直接把住处的网络整成公网的呢，直接在住处架设frps，省的数据从望京发到昌平再传回望京2333 至少也可以把frps装在华硕路由上，和nas一样是arm架构，一样有ssh，还省去转发的过程","categories":[],"tags":[]},{"title":"Hello World","slug":"hello-world","date":"2021-09-29T02:43:25.537Z","updated":"2021-09-29T02:43:25.537Z","comments":true,"path":"2021/09/29/hello-world/","link":"","permalink":"http://example.com/2021/09/29/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}],"categories":[],"tags":[]}